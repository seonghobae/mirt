<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Extract Empirical Estimating Functions — estfun.AllModelClass • mirt</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extract Empirical Estimating Functions — estfun.AllModelClass"><meta name="description" content="A function for extracting the empirical estimating functions of a fitted
mirt, multipleGroup, bfactor, or
mdirt model. This is the derivative of the log-likelihood with respect to the
parameter vector, evaluated at the observed (case-wise) data. In other
words, this function returns the case-wise scores, evaluated at the fitted
model parameters. Currently, models fitted via the EM or BL
method are supported. For the computations, the internal Theta grid of
the model is being used which was already used during the estimation of
the model itself along with its matching normalized density."><meta property="og:description" content="A function for extracting the empirical estimating functions of a fitted
mirt, multipleGroup, bfactor, or
mdirt model. This is the derivative of the log-likelihood with respect to the
parameter vector, evaluated at the observed (case-wise) data. In other
words, this function returns the case-wise scores, evaluated at the fitted
model parameters. Currently, models fitted via the EM or BL
method are supported. For the computations, the internal Theta grid of
the model is being used which was already used during the estimation of
the model itself along with its matching normalized density."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mirt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.43</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/mirt-vignettes.html">UNKNOWN TITLE</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/philchalmers/mirt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Extract Empirical Estimating Functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/philchalmers/mirt/blob/main/R/estfun.R" class="external-link"><code>R/estfun.R</code></a></small>
      <div class="d-none name"><code>estfun.AllModelClass.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A function for extracting the empirical estimating functions of a fitted
<code><a href="mirt.html">mirt</a></code>, <code><a href="multipleGroup.html">multipleGroup</a></code>, <code><a href="bfactor.html">bfactor</a></code>, or
<code><a href="mdirt.html">mdirt</a></code> model. This is the derivative of the log-likelihood with respect to the
parameter vector, evaluated at the observed (case-wise) data. In other
words, this function returns the case-wise scores, evaluated at the fitted
model parameters. Currently, models fitted via the <code>EM</code> or <code>BL</code>
method are supported. For the computations, the internal <code>Theta</code> grid of
the model is being used which was already used during the estimation of
the model itself along with its matching normalized density.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estfun.AllModelClass</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="extract.mirt.html">extract.mirt</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"survey.weights"</span><span class="op">)</span>,</span>
<span>  centering <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a fitted model object of class <code>SingleGroupClass</code>,
<code>MultipleGroupClass</code>, or <code>DiscreteClass</code></p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>by default, the <code>survey.weights</code> which were (optionally)
specified when fitting the model are included to calculate the scores.
If specified by the user, this should be a numeric vector of length equal
to the total sample size. Note that if not all cases were weighted equally
when fitting the model, the weights must be corrected by taking their
square root if the scores are being used to compute the outer product of
gradients (OPG) estimate of the variance-covariance matrix (see examples
below).</p></dd>


<dt id="arg-centering">centering<a class="anchor" aria-label="anchor" href="#arg-centering"></a></dt>
<dd><p>a boolean variable that allows the centering of the case-wise
scores (i.e., setting their expected values to 0). If the case-wise scores were
obtained from maximum likelihood estimates, this setting does not affect the result.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An n x k matrix corresponding to n observations and k parameters</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="mirt.html">mirt</a></code>, <code><a href="multipleGroup.html">multipleGroup</a></code>,
  <code><a href="bfactor.html">bfactor</a></code>, <code><a href="mdirt.html">mdirt</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Lennart Schneider <a href="mailto:lennart.sch@web.de">lennart.sch@web.de</a> and Phil Chalmers;
centering argument contributed by Rudolf Debelak
(<a href="mailto:rudolf.debelak@psychologie.uzh.ch">rudolf.debelak@psychologie.uzh.ch</a>)</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># fit a 2PL on the LSAT7 data and get the scores</span></span></span>
<span class="r-in"><span><span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="mirt.html">mirt</a></span><span class="op">(</span><span class="fu"><a href="expand.table.html">expand.table</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">)</span>, <span class="fl">1</span>, SE <span class="op">=</span> <span class="cn">TRUE</span>, SE.type <span class="op">=</span> <span class="st">"crossprod"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc1</span> <span class="op">&lt;-</span> <span class="fu">estfun.AllModelClass</span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get the gradient</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">sc1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># calculate the OPG estimate of the variance-covariance matrix "by hand"</span></span></span>
<span class="r-in"><span><span class="va">vc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">sc1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chol2inv.html" class="external-link">chol2inv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">vc1</span><span class="op">)</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Discrete group</span></span></span>
<span class="r-in"><span><span class="va">modd</span> <span class="op">&lt;-</span> <span class="fu"><a href="mdirt.html">mdirt</a></span><span class="op">(</span><span class="fu"><a href="expand.table.html">expand.table</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">)</span>, <span class="fl">2</span>, SE <span class="op">=</span> <span class="cn">TRUE</span>, SE.type <span class="op">=</span> <span class="st">"crossprod"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc1</span> <span class="op">&lt;-</span> <span class="fu">estfun.AllModelClass</span><span class="op">(</span><span class="va">modd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get the gradient</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">sc1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># calculate the OPG estimate of the variance-covariance matrix "by hand"</span></span></span>
<span class="r-in"><span><span class="va">vc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">modd</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">sc1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chol2inv.html" class="external-link">chol2inv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">vc1</span><span class="op">)</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a multiple group 2PL and do the same as above</span></span></span>
<span class="r-in"><span><span class="va">group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"G1"</span>, <span class="st">"G2"</span><span class="op">)</span>, <span class="fl">500</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="multipleGroup.html">multipleGroup</a></span><span class="op">(</span><span class="fu"><a href="expand.table.html">expand.table</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">)</span>, <span class="fl">1</span>, <span class="va">group</span>, SE <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  SE.type <span class="op">=</span> <span class="st">"crossprod"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc2</span> <span class="op">&lt;-</span> <span class="fu">estfun.AllModelClass</span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">sc2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vc2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">sc2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chol2inv.html" class="external-link">chol2inv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">vc2</span><span class="op">)</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a bifactor model with 2 specific factors and do the same as above</span></span></span>
<span class="r-in"><span><span class="va">mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="bfactor.html">bfactor</a></span><span class="op">(</span><span class="fu"><a href="expand.table.html">expand.table</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, SE <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  SE.type <span class="op">=</span> <span class="st">"crossprod"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc3</span> <span class="op">&lt;-</span> <span class="fu">estfun.AllModelClass</span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">sc3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vc3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">sc3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chol2inv.html" class="external-link">chol2inv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">vc3</span><span class="op">)</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit a 2PL not weighting all cases equally</span></span></span>
<span class="r-in"><span><span class="va">survey.weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">$</span><span class="va">freq</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">$</span><span class="va">freq</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">survey.weights</span> <span class="op">&lt;-</span> <span class="va">survey.weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">survey.weights</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">$</span><span class="va">freq</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="mirt.html">mirt</a></span><span class="op">(</span><span class="fu"><a href="expand.table.html">expand.table</a></span><span class="op">(</span><span class="va">LSAT7</span><span class="op">)</span>, <span class="fl">1</span>, SE <span class="op">=</span> <span class="cn">TRUE</span>, SE.type <span class="op">=</span> <span class="st">"crossprod"</span>,</span></span>
<span class="r-in"><span>  survey.weights <span class="op">=</span> <span class="va">survey.weights</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sc4</span> <span class="op">&lt;-</span> <span class="fu">estfun.AllModelClass</span><span class="op">(</span><span class="va">mod4</span>,</span></span>
<span class="r-in"><span>  weights <span class="op">=</span> <span class="fu"><a href="extract.mirt.html">extract.mirt</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="st">"survey.weights"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get the gradient</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">sc4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># to calculate the OPG estimate of the variance-covariance matrix "by hand",</span></span></span>
<span class="r-in"><span><span class="co"># the weights must be adjusted by taking their square root</span></span></span>
<span class="r-in"><span><span class="va">sc4_crp</span> <span class="op">&lt;-</span> <span class="fu">estfun.AllModelClass</span><span class="op">(</span><span class="va">mod4</span>,</span></span>
<span class="r-in"><span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="extract.mirt.html">extract.mirt</a></span><span class="op">(</span><span class="va">mod4</span>, <span class="st">"survey.weights"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vc4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">mod4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/crossprod.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">sc4_crp</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chol2inv.html" class="external-link">chol2inv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chol.html" class="external-link">chol</a></span><span class="op">(</span><span class="va">vc4</span><span class="op">)</span><span class="op">)</span>, check.attributes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phil Chalmers.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

